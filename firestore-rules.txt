rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Newsletter collection
    match /newsletter_emails/{document} {
      // Allow anyone to create newsletter signups with valid data
      allow create: if request.resource.data.keys().hasAll(['email', 'subscribedAt', 'status', 'source'])
        && request.resource.data.email is string
        && request.resource.data.email.matches('.*@.*[.].*')
        && request.resource.data.status == 'active'
        && request.resource.data.source == 'website';
      
      // Allow read/delete for localhost development (admin functions)
      // In production, replace this with proper Firebase Auth admin claims
      allow read, delete: if request.time != null; // Always allow for now - secure with auth later
    }
    
    // Block all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
} 